<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - TourneyHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* -------------------- CSS Variables & Reset -------------------- */
        :root {
          --primary: #6366f1;
          --primary-dark: #4f46e5;
          --primary-light: #818cf8;
          --secondary: #f59e0b;
          --success: #10b981;
          --warning: #f59e0b;
          --error: #ef4444;
          --background: #0f0f23;
          --surface: #1a1a2e;
          --surface-light: #252547;
          --surface-dark: #0a0a1a;
          --text-primary: #f8fafc;
          --text-secondary: #cbd5e1;
          --text-muted: #64748b;
          --border: #2d3748;
          --border-light: #374151;
          --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
          --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
          --radius: 12px;
          --radius-sm: 8px;
          --transition: all 0.2s ease-in-out;
        }

        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
          background: var(--background);
          color: var(--text-primary);
          font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
          line-height: 1.6;
          min-height: 100vh;
          overflow-x: hidden;
          padding-bottom: 80px; /* Space for bottom nav */
        }

        /* -------------------- Glass Morphism Header -------------------- */
        header {
          background: rgba(26, 26, 46, 0.8);
          backdrop-filter: blur(20px);
          border-bottom: 1px solid var(--border);
          padding: 1rem 1.5rem;
          position: sticky;
          top: 0;
          z-index: 1000;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .logo {
          font-size: 1.5rem;
          font-weight: 700;
          background: linear-gradient(135deg, var(--primary), var(--primary-light));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          text-decoration: none;
        }

        #adminBadge {
          background: var(--surface-light);
          padding: 0.5rem 1rem;
          border-radius: var(--radius-sm);
          font-size: 0.875rem;
          border: 1px solid var(--border);
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        .badge-icon {
          font-size: 1rem;
        }

        /* -------------------- Main Layout -------------------- */
        main {
          flex: 1;
          padding: 1.5rem;
          max-width: 1400px;
          margin: 0 auto;
          width: 100%;
        }

        /* -------------------- Enhanced Card Design -------------------- */
        .card {
          background: var(--surface);
          border: 1px solid var(--border);
          border-radius: var(--radius);
          padding: 1.5rem;
          margin-bottom: 1.5rem;
          box-shadow: var(--shadow);
          transition: var(--transition);
        }

        .card:hover {
          box-shadow: var(--shadow-lg);
          transform: translateY(-2px);
        }

        .card h2 {
          font-size: 1.5rem;
          font-weight: 600;
          margin-bottom: 1rem;
          color: var(--text-primary);
          display: flex;
          align-items: center;
          gap: 0.5rem;
        }

        /* -------------------- Modern Tabs -------------------- */
        .tabs {
          display: flex;
          gap: 0.5rem;
          margin-bottom: 1.5rem;
          background: var(--surface-dark);
          padding: 0.5rem;
          border-radius: var(--radius);
          border: 1px solid var(--border);
          overflow-x: auto;
          scrollbar-width: none; /* Firefox */
        }

        .tabs::-webkit-scrollbar {
          display: none; /* Chrome, Safari, Edge */
        }

        .tab {
          flex: 1;
          padding: 0.75rem 1rem;
          background: transparent;
          border: none;
          border-radius: var(--radius-sm);
          color: var(--text-secondary);
          font-weight: 500;
          cursor: pointer;
          transition: var(--transition);
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 0.5rem;
          white-space: nowrap;
          min-width: max-content;
        }

        .tab:hover {
          background: var(--surface-light);
          color: var(--text-primary);
        }

        .tab.active {
          background: var(--primary);
          color: white;
          box-shadow: var(--shadow);
        }

        .tab-icon {
          font-size: 1.1rem;
        }

        /* -------------------- Enhanced Form Controls -------------------- */
        .row {
          display: flex;
          gap: 1rem;
          flex-wrap: wrap;
          align-items: center;
          margin: 1rem 0;
        }

        .search-container {
          position: relative;
          flex: 1;
          min-width: 300px;
        }

        .search-container input {
          width: 100%;
          padding-left: 2.5rem;
        }

        .search-icon {
          position: absolute;
          left: 1rem;
          top: 50%;
          transform: translateY(-50%);
          color: var(--text-muted);
        }

        input, select, textarea {
          padding: 0.75rem 1rem;
          background: var(--surface-dark);
          border: 1px solid var(--border);
          border-radius: var(--radius-sm);
          color: var(--text-primary);
          font-size: 0.875rem;
          transition: var(--transition);
        }

        input:focus, select:focus, textarea:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        input::placeholder {
          color: var(--text-muted);
        }

        /* -------------------- Modern Buttons -------------------- */
        button {
          padding: 0.75rem 1.5rem;
          border: none;
          border-radius: var(--radius-sm);
          font-weight: 500;
          font-size: 0.875rem;
          cursor: pointer;
          transition: var(--transition);
          display: inline-flex;
          align-items: center;
          gap: 0.5rem;
        }

        button:not(.ghost):not(.danger):not(.warning):not(.success) {
          background: var(--primary);
          color: white;
        }

        button:hover {
          transform: translateY(-1px);
          box-shadow: var(--shadow);
        }

        button.ghost {
          background: transparent;
          border: 1px solid var(--border);
          color: var(--text-secondary);
        }

        button.ghost:hover {
          border-color: var(--primary);
          color: var(--primary);
        }

        button.small {
          padding: 0.5rem 1rem;
          font-size: 0.75rem;
        }

        button.danger {
          background: var(--error);
          color: white;
        }

        button.warning {
          background: var(--warning);
          color: white;
        }

        button.success {
          background: var(--success);
          color: white;
        }

        .btn-icon {
          font-size: 0.9rem;
        }

        /* -------------------- Status & Badges -------------------- */
        .status-badge {
          padding: 0.25rem 0.75rem;
          border-radius: 20px;
          font-size: 0.75rem;
          font-weight: 500;
          text-transform: capitalize;
        }

        .status-badge.verified, .status-badge.approved, .status-badge.completed {
          background: rgba(16, 185, 129, 0.2);
          color: var(--success);
          border: 1px solid var(--success);
        }

        .status-badge.pending, .status-badge.draft {
          background: rgba(245, 158, 11, 0.2);
          color: var(--warning);
          border: 1px solid var(--warning);
        }

        .status-badge.unverified, .status-badge.cancelled, .status-badge.rejected {
          background: rgba(239, 68, 68, 0.2);
          color: var(--error);
          border: 1px solid var(--error);
        }

        .role-badge {
          padding: 0.25rem 0.5rem;
          border-radius: 6px;
          font-size: 0.75rem;
          font-weight: 500;
        }

        .role-badge.admin {
          background: rgba(99, 102, 241, 0.2);
          color: var(--primary);
          border: 1px solid var(--primary);
        }

        .role-badge.user {
          background: rgba(100, 116, 139, 0.2);
          color: var(--text-muted);
          border: 1px solid var(--text-muted);
        }

        /* -------------------- Enhanced Tables -------------------- */
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 1rem;
          background: var(--surface-dark);
          border-radius: var(--radius-sm);
          overflow: hidden;
        }

        th {
          background: var(--surface-light);
          padding: 1rem;
          text-align: left;
          font-weight: 600;
          font-size: 0.875rem;
          color: var(--text-primary);
          border-bottom: 1px solid var(--border);
        }

        td {
          padding: 1rem;
          border-bottom: 1px solid var(--border);
          font-size: 0.875rem;
          color: var(--text-secondary);
        }

        tr:last-child td {
          border-bottom: none;
        }

        tr:hover {
          background: var(--surface-light);
        }

        .action-row {
          display: flex;
          gap: 0.5rem;
          flex-wrap: wrap;
        }

        /* -------------------- Card Grid Layout -------------------- */
        .card-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
          gap: 1rem;
          margin-top: 1rem;
        }

        .card-small {
          background: var(--surface-dark);
          border: 1px solid var(--border);
          border-radius: var(--radius-sm);
          padding: 1rem;
          transition: var(--transition);
        }

        .card-small:hover {
          border-color: var(--primary);
          transform: translateY(-2px);
          box-shadow: var(--shadow);
        }

        /* -------------------- Statistics Cards -------------------- */
        .stats-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 1rem;
          margin: 1.5rem 0;
        }

        .stat-card {
          background: var(--surface-dark);
          padding: 1.5rem;
          border-radius: var(--radius);
          border: 1px solid var(--border);
          text-align: center;
          transition: var(--transition);
        }

        .stat-card:hover {
          border-color: var(--primary);
          transform: translateY(-2px);
        }

        .stat-number {
          font-size: 2rem;
          font-weight: 700;
          background: linear-gradient(135deg, var(--primary), var(--primary-light));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          margin-bottom: 0.5rem;
        }

        .stat-label {
          color: var(--text-muted);
          font-size: 0.875rem;
          font-weight: 500;
        }

        /* -------------------- Loading & States -------------------- */
        .loading-state, .error-state, .no-data {
          text-align: center;
          padding: 3rem 2rem;
          color: var(--text-muted);
        }

        .spinner {
          width: 40px;
          height: 40px;
          border: 3px solid var(--border);
          border-top: 3px solid var(--primary);
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin: 0 auto 1rem;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        /* -------------------- Notifications -------------------- */
        .notification {
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 1rem 1.5rem;
          border-radius: var(--radius);
          color: white;
          font-weight: 500;
          z-index: 10000;
          box-shadow: var(--shadow-lg);
          animation: slideIn 0.3s ease-out;
        }

        .notification.success {
          background: var(--success);
        }

        .notification.error {
          background: var(--error);
        }

        .notification.info {
          background: var(--primary);
        }

        @keyframes slideIn {
          from {
            transform: translateX(100%);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }

        /* -------------------- Settings Sections -------------------- */
        .settings-section {
          margin-bottom: 2rem;
        }

        .setting-item {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem 0;
          border-bottom: 1px solid var(--border);
        }

        .setting-item:last-child {
          border-bottom: none;
        }

        .danger-zone {
          background: rgba(239, 68, 68, 0.1);
          border: 1px solid var(--error);
          border-radius: var(--radius);
          padding: 1.5rem;
        }

        .danger-zone .setting-item {
          border-bottom-color: rgba(239, 68, 68, 0.3);
        }

        /* -------------------- Mobile Bottom Navigation -------------------- */
        .bottom-nav {
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background: var(--surface);
          border-top: 1px solid var(--border);
          display: flex;
          justify-content: space-around;
          padding: 0.75rem 0;
          backdrop-filter: blur(20px);
          z-index: 1000;
        }

        .nav-item {
          display: flex;
          flex-direction: column;
          align-items: center;
          text-decoration: none;
          color: var(--text-muted);
          transition: var(--transition);
          padding: 0.5rem;
          border-radius: var(--radius-sm);
          flex: 1;
          max-width: 80px;
        }

        .nav-item:hover,
        .nav-item.active {
          color: var(--primary);
          background: var(--surface-light);
        }

        .nav-icon {
          font-size: 1.25rem;
          margin-bottom: 4px;
        }

        .nav-text {
          font-size: 0.75rem;
          font-weight: 500;
        }

        /* -------------------- Mobile App Enhancements -------------------- */
        .mobile-section {
          display: none;
        }

        .mobile-card {
          background: var(--surface);
          border: 1px solid var(--border);
          border-radius: var(--radius);
          padding: 1rem;
          margin-bottom: 1rem;
          transition: var(--transition);
        }

        .mobile-card:hover {
          border-color: var(--primary);
        }

        .mobile-card-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 0.75rem;
        }

        .mobile-card-title {
          font-weight: 600;
          font-size: 1rem;
        }

        .mobile-card-content {
          color: var(--text-secondary);
          font-size: 0.875rem;
        }

        .mobile-actions {
          display: flex;
          gap: 0.5rem;
          margin-top: 0.75rem;
        }

        .mobile-action-btn {
          flex: 1;
          padding: 0.5rem;
          font-size: 0.75rem;
          text-align: center;
        }

        .mobile-stats {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 0.75rem;
          margin: 1rem 0;
        }

        .mobile-stat {
          background: var(--surface-dark);
          padding: 1rem;
          border-radius: var(--radius-sm);
          text-align: center;
        }

        .mobile-stat-value {
          font-size: 1.5rem;
          font-weight: 700;
          color: var(--primary);
          margin-bottom: 0.25rem;
        }

        .mobile-stat-label {
          font-size: 0.75rem;
          color: var(--text-muted);
        }

        /* -------------------- Modal Styles -------------------- */
        .modal-overlay {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0, 0, 0, 0.7);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
          padding: 20px;
        }
        
        .modal {
          background: var(--surface);
          border-radius: 12px;
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
          width: 100%;
          max-width: 500px;
        }
        
        .modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 20px;
          border-bottom: 1px solid var(--border);
        }
        
        .modal-header h3 {
          margin: 0;
          font-size: 1.25rem;
        }
        
        .modal-close {
          background: none;
          border: none;
          font-size: 24px;
          cursor: pointer;
          color: var(--text-muted);
          padding: 0;
          width: 30px;
          height: 30px;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .modal-close:hover {
          color: var(--text-primary);
        }
        
        .modal-body {
          padding: 20px;
        }
        
        .form-group {
          margin-bottom: 16px;
        }
        
        .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 12px;
        }
        
        .form-group label {
          display: block;
          margin-bottom: 6px;
          font-weight: 500;
          color: var(--text-primary);
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
          width: 100%;
          padding: 10px 12px;
          border: 1px solid var(--border);
          border-radius: 8px;
          background: var(--surface-dark);
          color: var(--text-primary);
          font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .modal-actions {
          display: flex;
          gap: 12px;
          justify-content: flex-end;
          margin-top: 24px;
          padding-top: 16px;
          border-top: 1px solid var(--border);
        }

        /* -------------------- Responsive Design -------------------- */
        @media (max-width: 768px) {
          main {
            padding: 1rem;
          }
          
          header {
            padding: 1rem;
            flex-direction: column;
            gap: 1rem;
          }
          
          .tabs {
            flex-direction: column;
          }
          
          .row {
            flex-direction: column;
          }
          
          .search-container {
            min-width: 100%;
          }
          
          input, select, button {
            width: 100%;
          }
          
          .card-grid {
            grid-template-columns: 1fr;
          }
          
          .stats-grid {
            grid-template-columns: 1fr;
          }
          
          table {
            display: block;
            overflow-x: auto;
          }
          
          .action-row {
            justify-content: center;
          }

          /* Show mobile sections, hide desktop sections */
          .desktop-section {
            display: none;
          }
          
          .mobile-section {
            display: block;
          }
        }

        @media (max-width: 480px) {
          .card {
            padding: 1rem;
          }
          
          .tab {
            padding: 0.5rem;
            font-size: 0.75rem;
          }
          
          .tab-icon {
            font-size: 1rem;
          }

          .mobile-stats {
            grid-template-columns: 1fr;
          }
        }

        /* -------------------- Utility Classes -------------------- */
        .muted {
          color: var(--text-muted);
        }

        .text-center {
          text-align: center;
        }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }

        .flex {
          display: flex;
        }

        .items-center {
          align-items: center;
        }

        .justify-between {
          justify-content: space-between;
        }

        .gap-2 {
          gap: 0.5rem;
        }

        .gap-4 {
          gap: 1rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo">TourneyHub Admin</div>
        <div class="flex items-center gap-4">
            <div class="search-container">
                <input type="text" id="globalSearch" placeholder="Search...">
                <i class="fas fa-search search-icon"></i>
            </div>
            <button id="refreshBtn" class="small">
                <i class="fas fa-sync-alt btn-icon"></i>
                Refresh
            </button>
            <button id="signOut" class="small danger">
                <i class="fas fa-sign-out-alt btn-icon"></i>
                Sign Out
            </button>
            <div id="adminBadge">
                <i class="fas fa-shield-alt badge-icon"></i>
                <span class="badge-text">Loading...</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Tabs Navigation -->
        <nav class="tabs">
            <button class="tab active" data-tab="users">
                <i class="fas fa-users tab-icon"></i>
                <span>Users</span>
            </button>
            <button class="tab" data-tab="tournaments">
                <i class="fas fa-trophy tab-icon"></i>
                <span>Tournaments</span>
            </button>
            <button class="tab" data-tab="deposits">
                <i class="fas fa-money-bill-wave tab-icon"></i>
                <span>Deposits</span>
            </button>
            <button class="tab" data-tab="withdrawals">
                <i class="fas fa-wallet tab-icon"></i>
                <span>Withdrawals</span>
            </button>
            <button class="tab" data-tab="settings">
                <i class="fas fa-cog tab-icon"></i>
                <span>Settings</span>
            </button>
        </nav>

        <!-- Content Area -->
        <div id="content">
            <div class="loading-state">
                <div class="spinner"></div>
                <p>Loading admin interface...</p>
            </div>
        </div>
    </main>

    <!-- Mobile Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-tab="users">
            <i class="fas fa-users nav-icon"></i>
            <span class="nav-text">Users</span>
        </a>
        <a href="#" class="nav-item" data-tab="tournaments">
            <i class="fas fa-trophy nav-icon"></i>
            <span class="nav-text">Tournaments</span>
        </a>
        <a href="#" class="nav-item" data-tab="deposits">
            <i class="fas fa-money-bill-wave nav-icon"></i>
            <span class="nav-text">Deposits</span>
        </a>
        <a href="#" class="nav-item" data-tab="withdrawals">
            <i class="fas fa-wallet nav-icon"></i>
            <span class="nav-text">Withdrawals</span>
        </a>
        <a href="#" class="nav-item" data-tab="settings">
            <i class="fas fa-cog nav-icon"></i>
            <span class="nav-text">Settings</span>
        </a>
    </nav>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA7QsyV2yb4f_acY9ETQnTSna7YHxwOJw4",
            authDomain: "authapp-386ee.firebaseapp.com",
            projectId: "authapp-386ee",
            storageBucket: "authapp-386ee.appspot.com",
            messagingSenderId: "809698525310",
            appId: "1:809698525310:web:5cb7de80bde9ed1f26982f",
            measurementId: "G-EJZTSBSGQT"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;
        let activeTab = 'users';
        let searchQuery = '';
        let currentData = {
            users: [],
            tournaments: [],
            deposits: [],
            withdrawals: []
        };

        // Utility functions
        const escapeHtml = s => String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        const formatDate = timestamp => timestamp?.toDate ? timestamp.toDate().toLocaleDateString() : 'N/A';
        const formatDateTime = timestamp => timestamp?.toDate ? timestamp.toDate().toLocaleString() : 'N/A';

        const debounce = (fn, ms) => {
            let t;
            return (...a) => {
                clearTimeout(t);
                t = setTimeout(() => fn(...a), ms);
            };
        };

        const showNotification = (message, type = 'info') => {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        };

        // Tab switching functionality
        function setupTabNavigation() {
            const tabs = document.querySelectorAll('.tab');
            const bottomNavItems = document.querySelectorAll('.nav-item');
            
            // Handle top tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const target = tab.dataset.tab;
                    switchTab(target);
                });
            });
            
            // Handle bottom nav
            bottomNavItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const target = item.dataset.tab;
                    switchTab(target);
                });
            });
        }

        function switchTab(tabName) {
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            // Update bottom nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.tab === tabName);
            });
            
            // Update active tab and render
            activeTab = tabName;
            renderActiveTab();
        }

        // Render active tab
        async function renderActiveTab() {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading ${activeTab} data...</p>
                </div>
            `;
            
            try {
                switch (activeTab) {
                    case 'users':
                        await renderUsersAdmin();
                        break;
                    case 'tournaments':
                        await renderTournamentsAdmin();
                        break;
                    case 'deposits':
                        await renderDepositsAdmin();
                        break;
                    case 'withdrawals':
                        await renderWithdrawalsAdmin();
                        break;
                    case 'settings':
                        await renderSettingsAdmin();
                        break;
                }
            } catch (error) {
                console.error(`Error rendering ${activeTab}:`, error);
                content.innerHTML = `
                    <div class="error-state">
                        <h3>Error Loading ${activeTab}</h3>
                        <p>${error.message}</p>
                        <button onclick="renderActiveTab()" class="small">Retry</button>
                    </div>
                `;
            }
        }

        // User Management
        async function renderUsersAdmin() {
            const content = document.getElementById('content');
            
            try {
                const snap = await db.collection('users').orderBy('createdAt', 'desc').get();
                const users = [];
                snap.forEach(doc => {
                    users.push({ uid: doc.id, ...doc.data() });
                });
                
                currentData.users = users;

                // Filter based on search
                const filteredUsers = users.filter(u =>
                    !searchQuery || 
                    `${u.email || ''} ${u.uid || ''} ${u.role || ''}`
                        .toLowerCase().includes(searchQuery)
                );

                content.innerHTML = `
                    <div class="card">
                        <h2><i class="fas fa-users"></i> User Management</h2>
                        
                        <div class="row">
                            <div class="search-container">
                                <input type="text" id="userSearch" placeholder="Search users..." value="${searchQuery}">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                            <button class="small success" onclick="createUserModal()">
                                <i class="fas fa-plus btn-icon"></i>
                                Add User
                            </button>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${users.length}</div>
                                <div class="stat-label">Total Users</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${users.filter(u => u.role === 'admin').length}</div>
                                <div class="stat-label">Admins</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${users.filter(u => u.verified).length}</div>
                                <div class="stat-label">Verified</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${users.filter(u => !u.verified).length}</div>
                                <div class="stat-label">Pending</div>
                            </div>
                        </div>
                        
                        <!-- Desktop Table -->
                        <div class="desktop-section">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Verified</th>
                                        <th>Created</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${filteredUsers.length ? filteredUsers.map(user => `
                                        <tr>
                                            <td>
                                                <strong>${escapeHtml(user.email)}</strong>
                                                <div class="muted" style="font-size: 12px; margin-top: 4px;">
                                                    UID: ${user.uid.substring(0, 8)}...
                                                </div>
                                            </td>
                                            <td><span class="role-badge ${user.role || 'user'}">${escapeHtml(user.role || 'user')}</span></td>
                                            <td><span class="status-badge ${user.verified ? 'verified' : 'unverified'}">${user.verified ? 'Verified' : 'Unverified'}</span></td>
                                            <td>${formatDate(user.createdAt)}</td>
                                            <td class="action-row">
                                                ${user.role !== 'admin' ? `
                                                    <button class="ghost small" onclick="promoteUser('${user.uid}')">
                                                        <i class="fas fa-arrow-up btn-icon"></i>
                                                        Promote
                                                    </button>
                                                ` : user.uid !== currentUser.uid ? `
                                                    <button class="warning small" onclick="demoteUser('${user.uid}')">
                                                        <i class="fas fa-arrow-down btn-icon"></i>
                                                        Demote
                                                    </button>
                                                ` : ''}
                                                ${!user.verified ? `
                                                    <button class="success small" onclick="verifyUser('${user.uid}')">
                                                        <i class="fas fa-check btn-icon"></i>
                                                        Verify
                                                    </button>
                                                ` : user.uid !== currentUser.uid ? `
                                                    <button class="warning small" onclick="unverifyUser('${user.uid}')">
                                                        <i class="fas fa-times btn-icon"></i>
                                                        Unverify
                                                    </button>
                                                ` : ''}
                                            </td>
                                        </tr>
                                    `).join('') : '<tr><td colspan="5" class="no-data">No users found</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Mobile Cards -->
                        <div class="mobile-section">
                            ${filteredUsers.length ? filteredUsers.map(user => `
                                <div class="mobile-card">
                                    <div class="mobile-card-header">
                                        <div class="mobile-card-title">${escapeHtml(user.email)}</div>
                                        <span class="status-badge ${user.verified ? 'verified' : 'unverified'}">
                                            ${user.verified ? 'Verified' : 'Unverified'}
                                        </span>
                                    </div>
                                    <div class="mobile-card-content">
                                        <div class="muted">UID: ${user.uid.substring(0, 8)}...</div>
                                        <div class="muted">Role: <span class="role-badge ${user.role || 'user'}">${user.role || 'user'}</span></div>
                                        <div class="muted">Created: ${formatDate(user.createdAt)}</div>
                                    </div>
                                    <div class="mobile-actions">
                                        ${user.role !== 'admin' ? `
                                            <button class="ghost small mobile-action-btn" onclick="promoteUser('${user.uid}')">
                                                <i class="fas fa-arrow-up btn-icon"></i>
                                                Promote
                                            </button>
                                        ` : user.uid !== currentUser.uid ? `
                                            <button class="warning small mobile-action-btn" onclick="demoteUser('${user.uid}')">
                                                <i class="fas fa-arrow-down btn-icon"></i>
                                                Demote
                                            </button>
                                        ` : ''}
                                        ${!user.verified ? `
                                            <button class="success small mobile-action-btn" onclick="verifyUser('${user.uid}')">
                                                <i class="fas fa-check btn-icon"></i>
                                                Verify
                                            </button>
                                        ` : user.uid !== currentUser.uid ? `
                                            <button class="warning small mobile-action-btn" onclick="unverifyUser('${user.uid}')">
                                                <i class="fas fa-times btn-icon"></i>
                                                Unverify
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('') : '<div class="no-data">No users found</div>'}
                        </div>
                    </div>
                `;

                // Add search functionality
                const searchInput = document.getElementById('userSearch');
                searchInput.addEventListener('input', debounce(e => {
                    searchQuery = e.target.value.toLowerCase();
                    renderUsersAdmin();
                }, 300));

            } catch (error) {
                console.error('Error loading users:', error);
                content.innerHTML = `
                    <div class="error-state">
                        <h3>Error Loading Users</h3>
                        <p>${error.message}</p>
                        <button onclick="renderUsersAdmin()" class="small">Retry</button>
                    </div>
                `;
            }
        }

        // User management functions
        async function promoteUser(uid) {
            try {
                await db.collection('users').doc(uid).update({
                    role: 'admin',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                showNotification('User promoted to admin', 'success');
                await renderUsersAdmin();
            } catch (error) {
                console.error('Error promoting user:', error);
                showNotification('Failed to promote user', 'error');
            }
        }

        async function demoteUser(uid) {
            try {
                await db.collection('users').doc(uid).update({
                    role: 'user',
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                showNotification('User demoted to regular user', 'success');
                await renderUsersAdmin();
            } catch (error) {
                console.error('Error demoting user:', error);
                showNotification('Failed to demote user', 'error');
            }
        }

        async function verifyUser(uid) {
            try {
                await db.collection('users').doc(uid).update({
                    verified: true,
                    verificationStatus: 'verified',
                    verifiedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                showNotification('User verified successfully', 'success');
                await renderUsersAdmin();
            } catch (error) {
                console.error('Error verifying user:', error);
                showNotification('Failed to verify user', 'error');
            }
        }

        async function unverifyUser(uid) {
            try {
                await db.collection('users').doc(uid).update({
                    verified: false,
                    verificationStatus: 'unverified',
                    verifiedAt: null,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                showNotification('User verification revoked', 'success');
                await renderUsersAdmin();
            } catch (error) {
                console.error('Error unverifying user:', error);
                showNotification('Failed to revoke verification', 'error');
            }
        }

        // Tournament Management
        async function renderTournamentsAdmin() {
            const content = document.getElementById('content');
            
            try {
                const snap = await db.collection('tournaments').orderBy('createdAt', 'desc').get();
                const tournaments = [];
                snap.forEach(doc => {
                    tournaments.push({ id: doc.id, ...doc.data() });
                });
                
                currentData.tournaments = tournaments;

                content.innerHTML = `
                    <div class="card">
                        <h2><i class="fas fa-trophy"></i> Tournament Management</h2>
                        
                        <div class="row">
                            <div class="search-container">
                                <input type="text" id="tournamentSearch" placeholder="Search tournaments..." value="${searchQuery}">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                            <button class="small success" onclick="createTournamentModal()">
                                <i class="fas fa-plus btn-icon"></i>
                                Create Tournament
                            </button>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${tournaments.length}</div>
                                <div class="stat-label">Total Tournaments</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${tournaments.filter(t => t.status === 'active').length}</div>
                                <div class="stat-label">Active</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${tournaments.filter(t => t.status === 'upcoming').length}</div>
                                <div class="stat-label">Upcoming</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${tournaments.reduce((sum, t) => sum + (t.currentPlayers || 0), 0)}</div>
                                <div class="stat-label">Total Players</div>
                            </div>
                        </div>
                        
                        <!-- Desktop Table -->
                        <div class="desktop-section">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Title</th>
                                        <th>Game</th>
                                        <th>Status</th>
                                        <th>Players</th>
                                        <th>Prize Pool</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${tournaments.length ? tournaments.map(tournament => `
                                        <tr>
                                            <td>
                                                <strong>${escapeHtml(tournament.title || 'Untitled Tournament')}</strong>
                                                ${tournament.description ? `<div class="muted" style="font-size: 12px; margin-top: 4px;">${escapeHtml(tournament.description)}</div>` : ''}
                                            </td>
                                            <td>${escapeHtml(tournament.game || 'N/A')}</td>
                                            <td><span class="status-badge ${tournament.status || 'draft'}">${escapeHtml(tournament.status || 'draft')}</span></td>
                                            <td>${tournament.currentPlayers || 0}/${tournament.maxPlayers || '∞'}</td>
                                            <td>$${(tournament.prizePool || 0).toLocaleString()}</td>
                                            <td class="action-row">
                                                <button class="ghost small" onclick="viewTournament('${tournament.id}')">
                                                    <i class="fas fa-eye btn-icon"></i>
                                                    View
                                                </button>
                                                <button class="warning small" onclick="editTournamentModal('${tournament.id}')">
                                                    <i class="fas fa-edit btn-icon"></i>
                                                    Edit
                                                </button>
                                                ${tournament.status !== 'cancelled' ? `
                                                    <button class="danger small" onclick="cancelTournament('${tournament.id}')">
                                                        <i class="fas fa-times btn-icon"></i>
                                                        Cancel
                                                    </button>
                                                ` : ''}
                                            </td>
                                        </tr>
                                    `).join('') : '<tr><td colspan="6" class="no-data">No tournaments found</td></tr>'}
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Mobile Cards -->
                        <div class="mobile-section">
                            ${tournaments.length ? tournaments.map(tournament => `
                                <div class="mobile-card">
                                    <div class="mobile-card-header">
                                        <div class="mobile-card-title">${escapeHtml(tournament.title || 'Untitled Tournament')}</div>
                                        <span class="status-badge ${tournament.status || 'draft'}">${tournament.status || 'draft'}</span>
                                    </div>
                                    <div class="mobile-card-content">
                                        <div class="muted">Game: ${tournament.game || 'N/A'}</div>
                                        <div class="muted">Players: ${tournament.currentPlayers || 0}/${tournament.maxPlayers || '∞'}</div>
                                        <div class="muted">Prize: $${(tournament.prizePool || 0).toLocaleString()}</div>
                                        ${tournament.description ? `<div class="muted" style="margin-top: 8px;">${escapeHtml(tournament.description)}</div>` : ''}
                                    </div>
                                    <div class="mobile-actions">
                                        <button class="ghost small mobile-action-btn" onclick="viewTournament('${tournament.id}')">
                                            <i class="fas fa-eye btn-icon"></i>
                                            View
                                        </button>
                                        <button class="warning small mobile-action-btn" onclick="editTournamentModal('${tournament.id}')">
                                            <i class="fas fa-edit btn-icon"></i>
                                            Edit
                                        </button>
                                        ${tournament.status !== 'cancelled' ? `
                                            <button class="danger small mobile-action-btn" onclick="cancelTournament('${tournament.id}')">
                                                <i class="fas fa-times btn-icon"></i>
                                                Cancel
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('') : '<div class="no-data">No tournaments found</div>'}
                        </div>
                    </div>
                `;

            } catch (error) {
                console.error('Error loading tournaments:', error);
                content.innerHTML = `
                    <div class="error-state">
                        <h3>Error Loading Tournaments</h3>
                        <p>${error.message}</p>
                        <button onclick="renderTournamentsAdmin()" class="small">Retry</button>
                    </div>
                `;
            }
        }

        // Tournament management functions
        async function createTournamentModal() {
            showNotification('Create tournament functionality coming soon', 'info');
        }

        async function editTournamentModal(tournamentId) {
            showNotification('Edit tournament functionality coming soon', 'info');
        }

        async function viewTournament(tournamentId) {
            showNotification('View tournament functionality coming soon', 'info');
        }

        async function cancelTournament(tournamentId) {
            if (!confirm('Are you sure you want to cancel this tournament?')) return;
            
            try {
                await db.collection('tournaments').doc(tournamentId).update({
                    status: 'cancelled',
                    cancelledAt: firebase.firestore.FieldValue.serverTimestamp(),
                    cancelledBy: currentUser.uid
                });
                showNotification('Tournament cancelled successfully', 'success');
                await renderTournamentsAdmin();
            } catch (error) {
                console.error('Error cancelling tournament:', error);
                showNotification('Failed to cancel tournament', 'error');
            }
        }

        // Initialize the application
        function init() {
            setupTabNavigation();
            
            // Set up refresh button
            document.getElementById('refreshBtn').addEventListener('click', () => {
                renderActiveTab();
                showNotification('Data refreshed', 'success');
            });
            
            // Set up sign out button
            document.getElementById('signOut').addEventListener('click', async () => {
                try {
                    await auth.signOut();
                    showNotification('Signed out successfully', 'success');
                    setTimeout(() => {
                        window.location.href = '../login/login.html';
                    }, 1000);
                } catch (error) {
                    console.error('Sign out error:', error);
                    showNotification('Sign out failed', 'error');
                }
            });
            
            // Set up global search
            document.getElementById('globalSearch').addEventListener('input', debounce(e => {
                searchQuery = e.target.value.toLowerCase();
                renderActiveTab();
            }, 300));
            
            // Check authentication
            auth.onAuthStateChanged(async user => {
                if (!user) {
                    window.location.href = '../login/login.html';
                    return;
                }
                
                currentUser = user;
                
                // Check if user is admin
                try {
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    const isAdmin = userDoc.exists && userDoc.data().role === 'admin';
                    
                    if (!isAdmin) {
                        showNotification('Access denied - Admin privileges required', 'error');
                        await auth.signOut();
                        setTimeout(() => {
                            window.location.href = '../login/login.html';
                        }, 2000);
                        return;
                    }
                    
                    // Update admin badge
                    document.querySelector('.badge-text').textContent = user.email;
                    
                    // Render initial tab
                    await renderActiveTab();
                    
                } catch (error) {
                    console.error('Auth check error:', error);
                    showNotification('Authentication error', 'error');
                }
            });
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);

        // Add slideOut animation for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>